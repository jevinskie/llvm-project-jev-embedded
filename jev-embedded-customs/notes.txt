~/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/bin/clang -o fact-lib.elf fact-lib.c -I /opt/aarch64/aarch64-elf-llvm-2021-12-26/lib/clang-runtimes/aarch64_/include -L /opt/aarch64/aarch64-elf-llvm-2021-12-26/lib/clang-runtimes/aarch64_/lib -Wl,-r -v -Wl,--lto-load-pass-plugin=$HOME/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/lib/jev-embedded-customs.dylib

~/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/bin/opt -o fact-lib-o3.ll -S fact-lib.ll -load-pass-plugin ~/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/lib/jev-embedded-customs.dylib --passes='default<Os>'

~/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/bin/opt -O3 -o fact-lib-o3.ll -S fact-lib.ll -load ~/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/lib/jev-embedded-customs.dylib -embcust
^ crashes

~/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/bin/clang -o fact.elf fact-lib.o fact-main.o -nostdlib -I /opt/aarch64/aarch64-elf-llvm-2021-12-26/lib/clang-runtimes/aarch64_/include -L /opt/aarch64/aarch64-elf-llvm-2021-12-26/lib/clang-runtimes/aarch64_/lib -Wl,-r -v -Wl,--lto-load-pass-plugin=$HOME/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/lib/jev-embedded-customs.dylib

~/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/bin/clang -o fact.elf fact-lib.o fact-main.o -nostdlib -I /opt/aarch64/aarch64-elf-llvm-2021-12-26/lib/clang-runtimes/aarch64_/include -L /opt/aarch64/aarch64-elf-llvm-2021-12-26/lib/clang-runtimes/aarch64_/lib -Wl,-r -v -Wl,--lto-load-pass-plugin=$HOME/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/lib/jev-embedded-customs.dylib -Xlinker --lto-newpm-passes='default<Os>'

~/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/bin/ld.lld fact-lib.o fact-main.o -r --lto-load-pass-plugin=/Users/jevin/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/lib/jev-embedded-customs.dylib -Bstatic -L/opt/aarch64/aarch64-elf-llvm-2021-12-26/lib/clang-runtimes/aarch64_/lib -L/Users/jevin/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/bin/../lib/clang-runtimes/aarch64-none-elf/lib -L/Users/jevin/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/lib/clang/14.0.0/lib/baremetal -o fact.elf --lto-newpm-passes='default<Os>,embcust'

~/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/bin/ld.lld fact-lib.o fact-main.o -r --lto-load-pass-plugin=/Users/jevin/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/lib/jev-embedded-customs.dylib -Bstatic -L/opt/aarch64/aarch64-elf-llvm-2021-12-26/lib/clang-runtimes/aarch64_/lib -L/Users/jevin/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/bin/../lib/clang-runtimes/aarch64-none-elf/lib -L/Users/jevin/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/lib/clang/14.0.0/lib/baremetal -o fact.elf --lto-newpm-passes='embcust,default<Os>' -mllvm-plugin -exported-syms=fact-exports.txt

~/code/xtool/LLVM-embedded-toolchain-for-Arm/install-HEAD/LLVMEmbeddedToolchainForArm-HEAD/bin/ld.lld -r build/jevmachopp/apfs/miniz/libminiz.a build/jevmachopp/apfs/lzfse/liblzfse.a build/jevmachopp/apfs/bzip2/libbz2.a build/jevmachopp/apfs/libapfs.a --whole-archive build/jevmachopp/uleb128/libuleb128.a build/jevmachopp/libjevmachopp.a --no-whole-archive --lto-load-pass-plugin=/Users/jevin/code/xtool/LLVM-embedded-toolchain-for-Arm/build-HEAD/llvm/lib/jev-embedded-customs.dylib -mllvm-plugin -embcust-exported-syms=3rdparty/jevmachopp/jevmachopp-u-boot-apfs-exported-syms.txt -v -Bstatic -L/Users/jevin/code/xtool/LLVM-embedded-toolchain-for-Arm/install-HEAD/LLVMEmbeddedToolchainForArm-HEAD/bin/../lib/clang-runtimes/aarch64-none-elf/lib -L/Users/jevin/code/xtool/LLVM-embedded-toolchain-for-Arm/install-HEAD/LLVMEmbeddedToolchainForArm-HEAD/lib/clang/14.0.0/lib/baremetal --start-group -lc++ -lc++abi -lc -lm -lclang_rt.builtins-aarch64 --end-group -o build/jevmachopp/libjevmachopp.o --lto-newpm-passes='embcust<link_libgcc>,default<Os>' -mllvm-plugin -embcust-libgcc=/opt/aarch64/aarch64-elf-llvm-2021-12-26/lib/clang-runtimes/aarch64-none-elf/lib/libclang_rt.builtins-aarch64.a


* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1
  * frame #0: 0x0000000107b04c20 jev-embedded-customs.dylib` jev::EmbeddedCustomsPass::run(llvm::Module&, llvm::AnalysisManager<llvm::Module>&) [inlined] jev::runEmbeddedCustoms(M=<unavailable>, opts=<unavailable>)  at EmbeddedCustoms.cpp:398
    frame #1: 0x0000000107b04c20 jev-embedded-customs.dylib` jev::EmbeddedCustomsPass::run(this=0x000060000107dc88, M=0x0000000103727020, (null)=0x000000016fdfb008)  + 64 at EmbeddedCustoms.cpp:489
    frame #2: 0x000000010187a244 ld.lld` llvm::PassManager<llvm::Module, llvm::AnalysisManager<llvm::Module> >::run(this=<unavailable>, IR=0x0000000103727020, AM=<unavailable>)  + 388 at PassManager.h:525
    frame #3: 0x00000001008b98b0 ld.lld` llvm::lto::opt(llvm::lto::Config const&, llvm::TargetMachine*, unsigned int, llvm::Module&, bool, llvm::ModuleSummaryIndex*, llvm::ModuleSummaryIndex const*, std::__1::vector<unsigned char, std::__1::allocator<unsigned char> > const&) [inlined] runNewPMPasses(Conf=<unavailable>, Mod=<unavailable>, TM=<unavailable>, OptLevel=2, IsThinLTO=<unavailable>, ExportSummary=0x0000000103aee928, ImportSummary=0x0000000000000000)  + 4240 at LTOBackend.cpp:328
    frame #4: 0x00000001008b8820 ld.lld` llvm::lto::opt(Conf=<unavailable>, TM=<unavailable>, Task=0, Mod=<unavailable>, IsThinLTO=false, ExportSummary=0x0000000103aee928, ImportSummary=0x0000000000000000, CmdArgs=<unavailable>)  + 1636 at LTOBackend.cpp:387
    frame #5: 0x00000001008ba194 ld.lld` llvm::lto::backend(C=0x0000000103aee400, AddStream=llvm::AddStreamFn @ 0x000000016fdfc628, ParallelCodeGenParallelismLevel=1, Mod=0x0000000103727020, CombinedIndex=0x0000000103aee928)>, unsigned int, llvm::Module&, llvm::ModuleSummaryIndex&)  + 168 at LTOBackend.cpp:536
    frame #6: 0x00000001008af38c ld.lld` llvm::lto::LTO::runRegularLTO(this=0x0000000103aee400, AddStream=llvm::AddStreamFn @ 0x000000016fdfc5c8)>)  + 1256 at LTO.cpp:1140
    frame #7: 0x00000001008aebe0 ld.lld` llvm::lto::LTO::run(this=0x0000000103aee400, AddStream=llvm::AddStreamFn @ 0x000000016fdfcad8, Cache=llvm::FileCache @ 0x000000016fdfcab8)>, std::__1::function<llvm::Expected<std::__1::function<llvm::Expected<std::__1::unique_ptr<llvm::CachedFileStream, std::__1::default_delete<llvm::CachedFileStream> > > (unsigned int)> > (unsigned int, llvm::StringRef)>)  + 996 at LTO.cpp:1038
    frame #8: 0x000000010021d070 ld.lld` lld::elf::BitcodeCompiler::compile(this=<unavailable>)  + 904 at LTO.cpp:320
    frame #9: 0x00000001001ce344 ld.lld` void lld::elf::LinkerDriver::compileBitcodeFiles<llvm::object::ELFType<(llvm::support::endianness)1, true> >(this=0x0000600000c13030)  + 160 at Driver.cpp:2004
    frame #10: 0x00000001001bfadc ld.lld` void lld::elf::LinkerDriver::link<llvm::object::ELFType<(llvm::support::endianness)1, true> >(this=0x0000600000c13030, args=0x000000016fdfd0b0)  + 2700 at Driver.cpp:2367
    frame #11: 0x00000001001b3794 ld.lld` lld::elf::LinkerDriver::linkerMain(this=0x0000600000c13030, argsArr=<unavailable>)  + 5944 at Driver.cpp:567
    frame #12: 0x00000001001b1ff8 ld.lld` lld::elf::link(args=ArrayRef<const char *> @ 0x0000600003096790, canExitEarly=<unavailable>, stdoutOS=0x0000000101fe9d78, stderrOS=<unavailable>)  + 1060 at Driver.cpp:123
    frame #13: 0x0000000100005b68 ld.lld` lldMain(argc=<unavailable>, argv=<unavailable>, stdoutOS=0x0000000101fe9d78, stderrOS=0x0000000101fe9de0, exitEarly=true)  + 1448 at lld.cpp:146
    frame #14: 0x00000001000054b0 ld.lld` main(argc=27, argv=0x000000016fdfdf30)  + 248 at lld.cpp:203
    frame #15: 0x00000001034e90f4 dyld` start  + 520

    